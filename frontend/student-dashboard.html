<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="/student-dashboard.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
    <h2>Welcome, <span th:text="${student.username}">Student</span></h2>

    <div class="notification" onclick="toggleDropdown(event)">
        ðŸ””
        <span th:if="${#lists.size(notifications) > 0}" th:text="${#lists.size(notifications)}"></span>

        <div class="dropdown" id="dropdown">
            <!-- If no notifications -->
            <p th:if="${notifications.isEmpty()}">No new notifications</p>

            <!-- Loop through notifications and display them -->
            <a th:each="n : ${notifications}" th:href="@{/students/mark-as-read(id=${n.id})}">
                <p th:text="${n.message}"></p>
            </a>
        </div>
    </div>
</div>

<!-- ================= CONTENT ================= -->
<div class="content">

    <!-- Upload Section -->
    <div class="card">
        <h3>Upload Document</h3>
        <p>Submit your assigned documents before the deadline.</p>

        <a th:href="@{/documents/upload}">
            <button>Upload Document</button>
        </a>
    </div>

    <!-- Submitted Documents & Feedback Section -->
    <div class="card">
        <h3>Submitted Documents & Feedback</h3>

        <table>
            <thead>
            <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Status</th>
                <th>Feedback</th>
                <th>Final Grade</th>
            </tr>
            </thead>

            <tbody>
            <!-- Loop through submitted documents -->
            <tr th:each="doc : ${documents}">
                <td th:text="${doc.title}"></td>
                <td th:text="${doc.type}"></td>

                <td th:class="${doc.status == 'Late'} ? 'late' : 'submitted'"
                    th:text="${doc.status}"></td>

                <td th:text="${doc.feedback != null ? doc.feedback : 'Pending'}"></td>

                <!-- FINAL GRADE -->
                <td>
        <span th:if="${doc.status == 'FINALIZED'}"
              th:text="${doc.grade}"
              style="font-weight:bold;color:green;">
        </span>

                    <span th:if="${doc.status != 'FINALIZED'}">
            Not Released
        </span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    // Toggle the visibility of the dropdown
    function toggleDropdown(event) {
        event.stopPropagation(); // Prevent event propagation to the body
        document.getElementById("dropdown").classList.toggle("show"); // Toggle visibility of the dropdown
    }

    // Close the dropdown if clicked outside of it
    window.onclick = function(event) {
        if (!event.target.closest('.notification')) {
            document.getElementById("dropdown").classList.remove("show"); // Hide dropdown if clicked outside
        }
    }
</script>

</body>
</html>
